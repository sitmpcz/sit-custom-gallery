var $=jQuery.noConflict();!function(l){"use strict";function e(){var e=this;e.$ajaxRemoveImages=!1,e.$ajaxGetImages=!1,e.confirmDelete=!1,e.$window=l(window),e.$document=l(document),e.$body=l("body"),e.$modalUploader=l("#sitg-uploader"),e.$dragDropZone=l("#drag-and-drop-zone"),e.$filesList=l("#files"),e.inputFileList=[],e.$btnDelete=l(".sitg-btn-delete"),e.$btnDeleteAll=l(".sitg-btn-delete-all"),e.$selectSort=l("#sitg-sort"),e.$imagePreviewList=l("#sitg-image-preview-list"),e.sitgSortable="",e.selectedItemsCache=[],e.init()}e.prototype={init:function(){var e=this;e.onBind(),e.bodyScrollClass(e)},onBind:function(){var i=this;i.$window.on("scroll",function(){i.bodyScrollClass(i)}),i.$body.on("click",".sitg-modal-open",function(e){i.$body.addClass("modal-open"),i.$modalUploader.show(),i.initUploader(),e.preventDefault()}),i.$body.on("click","#sitg-upload-start",function(e){i.$dragDropZone.dmUploader("start"),e.preventDefault()}),i.$body.on("click","#sitg-upload-cancel",function(e){i.$dragDropZone.dmUploader("cancel"),e.preventDefault()}),i.$body.on("click",".sitg-modal-delete-file",function(e){var a=l(this),t=a.data("id");i.$dragDropZone.hasClass("is-running")?i.$dragDropZone.dmUploader("cancel",t):(a.hasClass("delete-row-only")||i.$dragDropZone.dmUploader("delete",t),a.closest("li").slideUp(200,function(){a.remove()})),e.preventDefault()}),i.$body.on("click",".sitg-modal-close",function(e){i.modalClose(),e.preventDefault()}),i.$selectSort.on("change",function(){var e=this.value;i.ajaxGetImages(l(this),e),i.$body.addClass("sitg-sort-changed")}),i.$body.on("click",".sitg-handler-edit",function(e){i.editImageClose(),l(this).closest(".sitg-mb-list-ui-handle").find(".sitg-mb-edit-layer").addClass("is-open").fadeIn(200),e.preventDefault()}),i.$body.on("click",".sitg-handler-edit-save",function(e){i.ajaxEditImageHandler(l(this)),e.preventDefault()}),i.$body.on("keypress",".sitg-mb-edit-title",function(e){"13"==(e.keyCode?e.keyCode:e.which)&&(i.ajaxEditImageHandler(l(this)),e.preventDefault(),e.stopPropagation())}),i.$body.on("click",".sitg-handler-edit-close",function(e){i.editImageCacheTitle(l(this)),e.preventDefault()}),i.$document.keydown(function(e){(!0===e.cancelable&&"Esc"===e.key||"Escape"===e.key||27===e.keyCode)&&i.editImageCacheTitle(l(".sitg-mb-edit-layer.is-open"))}),i.$body.on("mousedown",function(e){var a=l(".sitg-mb-edit-layer.is-open");a.is(e.target)||0!==a.has(e.target).length||i.editImageCacheTitle(a)}),i.$body.on("click",".sitg-handler-featured",function(){i.ajaxSetFeaturedImage(l(this))}),i.$btnDelete.on("click",function(e){0<i.selectedItemsCache.length&&i.confirmDialogShow("Máme je opravdu smazat?","sitgDeleteSelected"),e.preventDefault()}),i.$btnDeleteAll.on("click",function(e){i.confirmDialogShow("Smažeme je všechny?","sitgDeleteAll"),e.preventDefault()}),i.$body.on("click","#sitg-confirm-yes",function(e){var a=l(this).closest("#sitg-confirm-dialog").data("action");i.$document.trigger(a),e.preventDefault()}),i.$body.on("click","#sitg-confirm-no",function(e){i.confirmDialogHide(),e.preventDefault()}),i.$document.on("sitgDeleteSelected",function(){var e=l(i.selectedItemsCache);i.confirmDialogHide(),i.ajaxRemoveImagesHandler(e),i.selectedItemsCache=[]}),i.$document.on("sitgDeleteAll",function(){var e=i.$imagePreviewList.find(".sitg-mb-list-ui-handle");i.confirmDialogHide(),i.ajaxRemoveImagesHandler(e)}),i.$imagePreviewList.find(".sitg-mb-list-ui-handle").length&&i.initSortable()},initSortable:function(){var t=this;void 0!==t.sitgSortable&&""!==t.sitgSortable&&t.sitgSortable.destroy(),t.sitgSortable=new Sortable(l("#sitg-image-preview-list")[0],{multiDrag:!0,selectedClass:"ui-selected",handle:".sitg-mb-list-item",filter:".sitg-mb-buttons",animation:200,onSelect:function(e){t.selectedItemsCache=e.items},onUpdate:function(e){t.selectedItemsCache=e.items}}),t.$body.on("mousedown",function(e){var a=l(".sitg-btn-delete, #sitg-confirm-yes");a.is(e.target)||0!==a.has(e.target).length||(t.selectedItemsCache=[])})},initUploader:function(){var s=this;s.$dragDropZone.dmUploader({url:sitg_ajax.ajax_url,extraData:{_ajax_nonce:sitg_ajax.nonce,action:"sitg_ajax_upload",post_id:s.$dragDropZone.data("id")},maxFileSize:sitg_ajax.max_upload_size,allowedTypes:"image/*",extFilter:["jpg","jpeg","png","gif"],auto:!1,queue:!0,onDragEnter:function(){this.addClass("active")},onDragLeave:function(){this.removeClass("active")},onInit:function(){s.ui_add_log("Penguin initialized :)","info")},onComplete:function(){s.uploaderToggleClass(),s.ui_add_log("All pending tranfers finished")},onNewFile:function(a,e,t){if(s.ui_multi_add_file(a,e,t),"undefined"!=typeof FileReader){var i=new FileReader,o=l("#uploaderFile"+a).find("img"),n=l("#uploaderFile"+a).find(".sitg-modal-delete-file");i.onload=function(e){o.attr("src",e.target.result),n.data("id",a)},i.readAsDataURL(e)}s.ui_add_log("Nová fotka: #"+a)},onFileTypeError:function(e){s.ui_add_log("File '"+e.name+"' cannot be added: file type is not allowed","danger")},onBeforeUpload:function(e){s.uploaderToggleClass("run"),s.ui_multi_update_file_status(e,"uploading","Nahrávání..."),s.ui_multi_update_file_progress(e,0,"",!0),s.ui_add_log("Starting the upload of #"+e)},onUploadCanceled:function(e){e||s.uploaderToggleClass(),console.log("canceled"),s.ui_multi_update_file_status(e,"warning","Nahrávání zrušeno"),s.ui_multi_update_file_progress(e,0,"warning",!1)},onUploadProgress:function(e,a){s.ui_multi_update_file_progress(e,a)},onUploadSuccess:function(e,a){var t=JSON.stringify(a),i=JSON.parse(t);s.ajaxGetImage(i.file_id),s.initSortable(),s.ui_multi_update_file_status(e,"success","Úspěšně jsme to nahráli :)"),s.ui_multi_update_file_progress(e,100,"success",!1),s.ui_add_log("Server Response for file #"+e+": "+JSON.stringify(a)),s.ui_add_log("Upload of file #"+e+" COMPLETED","success")},onUploadError:function(e,a,t,i){s.ui_multi_update_file_status(e,"danger",i),s.ui_multi_update_file_progress(e,0,"danger",!1)},onFallbackMode:function(){s.ui_add_log("Plugin cant be used here, running Fallback callback","danger")},onFileSizeError:function(e){s.ui_add_log("File '"+e.name+"' cannot be added: size excess limit","danger")}})},ui_multi_add_file:function(e,a,t){var i;this.$filesList.find("li.empty").fadeOut(),i=(i=!0!==t?(i=l("#no-validate-files-template").text()).replace("%%validate_message%%",t.message):l("#files-template").text()).replace("%%filename%%",a.name),(i=l(i)).prop("id","uploaderFile"+e),i.data("file-id",e),this.$filesList.prepend(i)},ui_multi_update_file_progress:function(e,a,t,i){t=void 0!==t&&t,i=void 0===i||i;var o=l("#uploaderFile"+e).find("div.progress-bar");o.width(a+"%").attr("aria-valuenow",a),o.toggleClass("progress-bar-striped progress-bar-animated",i),0===a?o.html(""):o.html(a+"%"),!1!==t&&(o.removeClass("bg-success bg-info bg-warning bg-danger"),o.addClass("bg-"+t))},ui_multi_update_file_status:function(e,a,t){l("#uploaderFile"+e).find(".sitg-status").html(t).prop("class","sitg-status status text-"+a)},ui_add_log:function(e,a){var t=new Date,i=("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2);a=void 0===a?"muted":a;var o=l("#debug-template").text();o=(o=(o=o.replace("%%date%%",i)).replace("%%message%%",e)).replace("%%color%%",a),l("#debug").find("li.empty").fadeOut(),l("#debug").prepend(o)},ajaxGetImage:function(e){var a=this;l.ajax({url:sitg_ajax.ajax_url,cache:!1,dataType:"html",data:{_ajax_nonce:sitg_ajax.nonce,action:"sitg_ajax_get_image",pid:e}}).done(function(e){l("#no-images-meta-info").remove(),a.$imagePreviewList.append(e)}).fail(function(e,a){console.log("SITg: AJAX error - ajaxGetImage() - "+a)})},ajaxGetImages:function(e,a){var t=this;if(t.$ajaxGetImages)return!1;t.$ajaxGetImages=l.ajax({url:sitg_ajax.ajax_url,method:"POST",cache:!1,dataType:"html",data:{_ajax_nonce:sitg_ajax.nonce,action:"sitg_ajax_get_images",post_id:e.data("id"),sort:a}}).done(function(e){t.$imagePreviewList.html(e),t.$ajaxGetImages=!1}).fail(function(e,a){console.log("SITg: AJAX error - ajaxRemoveImages() - "+a),t.$ajaxGetImages=!1})},ajaxRemoveImagesHandler:function(e){var a=this;if(a.$ajaxRemoveImages)return!1;if(e.length<1)return!1;var t=[];e.each(function(e,a){t[e]=l(this).data("pid")});var i=0,o=t.length;function n(){if(o<=i)return!(a.$ajaxRemoveImages=!1);l.ajax({url:sitg_ajax.ajax_url,method:"POST",cache:!1,dataType:"json",data:{_ajax_nonce:sitg_ajax.nonce,action:"sitg_ajax_remove_one_image",pid:t[i]}}).done(function(e){!function(e){if(1===e){var a=l("[data-pid="+t[i]+"]");a.find(".sitg-mb-list-item").fadeTo(150,0,function(){a.animate({height:0},150,function(){a.animate({width:0},150,function(){a.remove()})})})}i++,n()}(e)}).fail(function(e,a){console.log("SITg: AJAX error - ajaxRemoveImages() - "+a)})}n()},ajaxEditImageHandler:function(e){var t=this,a=e.closest(".sitg-mb-list-ui-handle"),i=a.find(".sitg-mb-edit-layer").find(".sitg-mb-edit-title").val(),o=a.data("pid");l.ajax({url:sitg_ajax.ajax_url,method:"POST",cache:!1,dataType:"json",data:{_ajax_nonce:sitg_ajax.nonce,action:"sitg_ajax_edit_image",pid:o,title:i}}).done(function(e){var a=l('.sitg-mb-list-ui-handle[data-pid="'+o+'" ]');0<e.response&&(a.find(".sitg-mb-list-item-title strong").text(i),a.find(".sitg-mb-edit-title").data("cache",i),t.editImageClose())}).fail(function(e,a){console.log("SITg: AJAX error - ajaxEditImageHandler() - "+a)})},ajaxSetFeaturedImage:function(e){var a=e.closest(".sitg-mb-list-ui-handle"),t=0;a.hasClass("is-featured")&&(t=1),l(".sitg-mb-list-ui-handle").removeClass("is-featured");var i=l("#sitg-image-preview-list").data("post-id"),o=a.data("pid");l.ajax({url:sitg_ajax.ajax_url,method:"POST",cache:!1,data:{_ajax_nonce:sitg_ajax.nonce,action:"sitg_ajax_set_featured_image",pid:o,post_id:i,selected:t}}).done(function(e){console.log(e),"unselected"!==e&&a.addClass("is-featured")}).fail(function(e,a){console.log("SITg: AJAX error - ajaxSetFeaturedImage() - "+a)})},editImageCacheTitle:function(e){var a,t;l(".sitg-mb-edit-layer").fadeOut(200,function(){a=e.closest(".sitg-mb-list-ui-handle"),(t=a.find(".sitg-mb-edit-title")).val(t.data("cache")),l(this).removeClass("is-open")})},editImageClose:function(){l(".sitg-mb-edit-layer").fadeOut(200).removeClass("is-open")},modalClose:function(){var e=this;e.$modalUploader.toggle(),e.$body.toggleClass("modal-open"),e.$dragDropZone.dmUploader("destroy"),e.$filesList.find(".media").remove(),e.$filesList.find(".empty").show()},confirmDialogShow:function(e,a){this.$body.addClass("modal-open");var t=l("#sitg-confirm-dialog-template").text();t=t.replace("%%title%%",e);var i=l(t);i.addClass("show"),i.attr("data-action",a),this.$body.prepend(i)},confirmDialogHide:function(){l("#sitg-confirm-dialog").remove(),this.$body.removeClass("modal-open")},uploaderToggleClass:function(e){"run"===e?(l("#sitg-upload-cancel").css({display:"inline-block"}),l("#sitg-modal-close-btn").css({display:"none"}),this.$dragDropZone.addClass("is-running")):(l("#sitg-upload-cancel").css({display:"none"}),l("#sitg-modal-close-btn").css({display:"inline-block"}),this.$dragDropZone.removeClass("is-running"))},bodyScrollClass:function(e){0<l("#sit_custom_gallery").length&&(e.$document.scrollTop()>l("#sit_custom_gallery").offset().top?e.$body.addClass("sitg-stick-on"):e.$body.removeClass("sitg-stick-on"))},getHostname:function(e){var a=e.match(/^http:\/\/[^/]+/);return a?a[0]:null}},l(document).ready(function(){new e})}(jQuery);
//# sourceMappingURL=sit-gallery-core.min.js.map
